<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="My Father Cigars Orders - Field Sales Application">
    <meta name="theme-color" content="#1a1a1a">
    <title>MFC Orders</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Navigation -->
        <nav class="main-nav">
            <div class="nav-brand">
                <h1>MFC Orders</h1>
                <span class="sync-status" id="syncStatus">
                    <span class="status-dot"></span>
                    <span class="status-text">Synced</span>
                </span>
            </div>
            <div class="nav-menu">
                <button class="nav-btn active" data-view="orders">Orders</button>
                <button class="nav-btn" data-view="customers">Customers</button>
                <button class="nav-btn" data-view="products">Products</button>
                <button class="nav-btn" data-view="analytics">Analytics</button>
                <button class="nav-btn" data-view="reports">Reports</button>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="content">
            <!-- Orders View -->
            <div class="view active" id="ordersView">
                <div class="view-header">
                    <h2>Orders</h2>
                    <button class="btn btn-primary" id="newOrderBtn">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M10 4V16M4 10H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        New Order
                    </button>
                </div>
                <div class="orders-list" id="ordersList">
                    <!-- Orders will be populated here -->
                </div>
            </div>

            <!-- Customers View -->
            <div class="view" id="customersView">
                <div class="view-header">
                    <h2>Customers</h2>
                    <button class="btn btn-primary" id="newCustomerBtn">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M10 4V16M4 10H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        New Customer
                    </button>
                </div>
                <div class="customer-filters">
                    <div class="state-filters">
                        <button class="state-btn active" data-state="all">All</button>
                        <button class="state-btn" data-state="AL">AL</button>
                        <button class="state-btn" data-state="GA">GA</button>
                        <button class="state-btn" data-state="TN">TN</button>
                        <button class="state-btn" data-state="MS">MS</button>
                    </div>
                    <div class="visit-filters">
                        <label style="font-size: 0.875rem; color: var(--text-secondary); margin-right: 0.5rem;">Last Visit:</label>
                        <button class="visit-filter-btn active" data-visit="all">All</button>
                        <button class="visit-filter-btn" data-visit="30">30+ days</button>
                        <button class="visit-filter-btn" data-visit="60">60+ days</button>
                        <button class="visit-filter-btn" data-visit="90">90+ days</button>
                        <button class="visit-filter-btn" data-visit="never">Never Visited</button>
                    </div>
                    <div class="search-box">
                        <input type="text" id="customerSearch" placeholder="Search customers...">
                    </div>
                </div>
                <div class="customers-grid" id="customersGrid">
                    <!-- Customers will be populated here -->
                </div>
            </div>

            <!-- Products View -->
            <div class="view" id="productsView">
                <div class="view-header">
                    <h2>Products</h2>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <div class="search-box">
                            <input type="text" id="productSearch" placeholder="Search products...">
                        </div>
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; color: var(--text-primary); font-size: 0.875rem;">
                            <input type="checkbox" id="showActiveOnly" checked style="cursor: pointer;">
                            Show Active Only
                        </label>
                        <button class="btn btn-primary" id="newProductBtn">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M10 4V16M4 10H16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            New Product
                        </button>
                    </div>
                </div>
                <div class="products-grid" id="productsGrid">
                    <!-- Products will be populated here -->
                </div>
            </div>

            <!-- Reports View -->
            <div class="view" id="reportsView">
                <div class="view-header">
                    <h2>Reports</h2>
                </div>
                <div class="reports-dashboard">
                    <!-- Sales by Year -->
                    <div style="margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem; color: var(--primary);">üìä Sales by Year</h3>
                        <div class="report-cards">
                            <div class="report-card">
                                <h3>2026 YTD</h3>
                                <div class="metric-value" id="sales2026">$0.00</div>
                                <div class="metric-label" id="orders2026">0 orders</div>
                            </div>
                            <div class="report-card">
                                <h3>2025 Total</h3>
                                <div class="metric-value" id="sales2025">$0.00</div>
                                <div class="metric-label" id="orders2025">0 orders</div>
                            </div>
                            <div class="report-card">
                                <h3>Top Customer (All-Time)</h3>
                                <div class="metric-value" id="topCustomer">‚Äî</div>
                                <div class="metric-label">By Revenue</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Daily & Weekly Sales Snapshot -->
                    <div style="margin: 2rem 0;">
                        <h3 style="margin-bottom: 1rem; color: var(--primary);">üìä Sales Snapshot</h3>
                        <div class="report-cards">
                            <div class="report-card">
                                <h3>Today</h3>
                                <div class="metric-value" id="todaySales">$0.00</div>
                                <div class="metric-label" id="todayOrders">0 orders</div>
                            </div>
                            <div class="report-card">
                                <h3>This Week</h3>
                                <div class="metric-value" id="weekSales">$0.00</div>
                                <div class="metric-label" id="weekOrders">0 orders</div>
                            </div>
                            <div class="report-card">
                                <h3>This Month</h3>
                                <div class="metric-value" id="monthSales">$0.00</div>
                                <div class="metric-label" id="monthOrders">0 orders</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="report-actions">
                        <button class="btn btn-primary" id="downloadAllOrdersCSV">üì• Download All Orders (CSV)</button>
                        <button class="btn btn-secondary" id="downloadAllOrdersJSON">üì• Download All Orders (JSON)</button>
                    </div>
                    
                    <div class="monthly-orders-section">
                        <h3 style="margin: 2rem 0 1rem 0; color: var(--primary);">Orders by Month</h3>
                        <div id="monthlyOrdersContainer"></div>
                    </div>
                </div>
            </div>

            <!-- Analytics View -->
            <div class="view" id="analyticsView">
                <div class="view-header">
                    <h2>Analytics</h2>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-primary" id="importHistoricalBtn">Import Historical Data</button>
                        <button class="btn btn-secondary" id="importYoYBtn">Import YoY Data</button>
                    </div>
                </div>
                <div class="analytics-dashboard">
                    <div class="analytics-section" id="yoySection">
                        <h3>üìä Year-over-Year Performance (Jan 1 - Dec 8)</h3>
                        <div id="yoyComparison"></div>
                    </div>
                    
                    <div class="analytics-section">
                        <h3>Customer Purchase History</h3>
                        <div class="customer-history-search">
                            <input type="text" id="historyCustomerSearch" placeholder="Search customer...">
                            <button class="btn btn-secondary" id="searchHistoryBtn">Search</button>
                        </div>
                        <div id="customerHistoryResults"></div>
                    </div>
                    
                    <div class="analytics-section" id="top10Section" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h3>üìä Top 10 Customers - Historical Performance</h3>
                            <button class="btn btn-primary" id="exportTop10PDF">üìÑ Export PDF</button>
                        </div>
                        <div id="top10Tables"></div>
                    </div>
                    
                    <div class="analytics-section" id="skuDropoffSection" style="display: none;">
                        <h3>‚ö†Ô∏è SKU Dropoff Alerts</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Products this customer ordered in the first half of 2025 but stopped ordering in the second half</p>
                        <div id="skuDropoffResults"></div>
                    </div>
                    
                    <div class="analytics-section" id="reorderPredictionSection" style="display: none;">
                        <h3>üîÑ Reorder Predictions</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Products this customer orders regularly and when they're due for reorder</p>
                        <div id="reorderPredictionResults"></div>
                    </div>
                    
                    <div class="analytics-section">
                        <h3>Top Products (Historical)</h3>
                        <div id="topProductsChart"></div>
                    </div>
                    
                    <div class="analytics-section">
                        <h3>Monthly Sales Trend</h3>
                        <div id="monthlySalesChart"></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Order Modal -->
        <div class="modal" id="orderModal">
            <div class="modal-content order-modal">
                <div class="modal-header">
                    <h2 id="orderModalTitle">New Order</h2>
                    <button class="modal-close" id="closeOrderModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="orderForm">
                        <div class="form-section">
                            <h3>Customer Information</h3>
                            <div class="customer-selector">
                                <div class="state-filters-compact">
                                    <button class="state-btn-compact active" data-state="all">All</button>
                                    <button class="state-btn-compact" data-state="AL">AL</button>
                                    <button class="state-btn-compact" data-state="GA">GA</button>
                                    <button class="state-btn-compact" data-state="TN">TN</button>
                                    <button class="state-btn-compact" data-state="MS">MS</button>
                                </div>
                                <div class="form-group">
                                    <label>Search & Select Customer</label>
                                    <input type="text" id="orderCustomerSearch" placeholder="Type to search...">
                                    <select id="orderCustomer" required size="5">
                                        <option value="">Select customer...</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Order Date</label>
                                    <input type="date" id="orderDate" required>
                                </div>
                                <div class="form-group">
                                    <label>PO Number (auto-generated, editable)</label>
                                    <input type="text" id="orderPO" placeholder="Auto-generated">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Order Items</h3>
                            <div class="order-items" id="orderItems">
                                <!-- Items will be added here -->
                            </div>
                            <button type="button" class="btn btn-secondary btn-block" id="addItemBtn">Add Item</button>
                        </div>

                        <div class="form-section">
                            <div class="order-totals">
                                <div class="total-row">
                                    <span>Subtotal:</span>
                                    <span id="orderSubtotal">$0.00</span>
                                </div>
                                <div class="total-row total-main">
                                    <span>Total:</span>
                                    <span id="orderTotal">$0.00</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Order Notes (Optional)</h3>
                            <div class="form-group">
                                <textarea id="orderNotes" rows="3" placeholder="Add notes about this order (e.g., 'Customer mentioned new location opening', 'Follow up on Judge Toro quality', etc.)"></textarea>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelOrderBtn">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Order</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Item Modal -->
        <div class="modal" id="itemModal">
            <div class="modal-content item-modal">
                <div class="modal-header">
                    <h2>Add Item</h2>
                    <button class="modal-close" id="closeItemModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="itemForm">
                        <div class="form-group">
                            <label>Category / Brand</label>
                            <select id="itemCategory" required>
                                <option value="">Select category...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Product</label>
                            <select id="itemProduct" required disabled>
                                <option value="">Select category first...</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Quantity</label>
                                <input type="number" id="itemQuantity" min="1" value="1" required>
                            </div>
                            <div class="form-group">
                                <label>Price</label>
                                <input type="number" id="itemPrice" step="0.01" min="0" required>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelItemBtn">Cancel</button>
                            <button type="submit" class="btn btn-primary">Add Item</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- New Customer Modal -->
        <div class="modal" id="customerModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="customerModalTitle">New Customer</h2>
                    <button class="modal-close" id="closeCustomerModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="customerForm">
                        <div class="form-group">
                            <label>Company Name *</label>
                            <input type="text" id="customerName" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Contact Name</label>
                                <input type="text" id="customerContact">
                            </div>
                            <div class="form-group">
                                <label>Tier</label>
                                <select id="customerTier">
                                    <option value="Main">Main</option>
                                    <option value="High">High</option>
                                    <option value="Medium" selected>Medium</option>
                                    <option value="Low">Low</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-section">
                            <h3>Shipping Address *</h3>
                            <div class="form-group">
                                <label>Street Address</label>
                                <input type="text" id="customerShipStreet">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>City *</label>
                                    <input type="text" id="customerShipCity" required>
                                </div>
                                <div class="form-group">
                                    <label>State *</label>
                                    <select id="customerShipState" required>
                                        <option value="">Select...</option>
                                        <option value="AL">Alabama</option>
                                        <option value="GA">Georgia</option>
                                        <option value="TN">Tennessee</option>
                                        <option value="MS">Mississippi</option>
                                        <option value="WV">West Virginia</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>ZIP Code</label>
                                <input type="text" id="customerShipZip">
                            </div>
                        </div>
                        <div class="form-section">
                            <h3>Billing Address (leave blank if same as shipping)</h3>
                            <div class="form-group">
                                <label>Street Address</label>
                                <input type="text" id="customerBillStreet">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>City</label>
                                    <input type="text" id="customerBillCity">
                                </div>
                                <div class="form-group">
                                    <label>State</label>
                                    <select id="customerBillState">
                                        <option value="">Select...</option>
                                        <option value="AL">Alabama</option>
                                        <option value="GA">Georgia</option>
                                        <option value="TN">Tennessee</option>
                                        <option value="MS">Mississippi</option>
                                        <option value="WV">West Virginia</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>ZIP Code</label>
                                <input type="text" id="customerBillZip">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Phone</label>
                                <input type="tel" id="customerPhone">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="customerEmail">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelCustomerBtn">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Customer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Customer Detail Modal (Visit Tracking) -->
        <div class="modal" id="customerDetailModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="customerDetailTitle">Customer Details</h2>
                    <button class="modal-close" id="closeCustomerDetailModal">&times;</button>
                </div>
                <div class="customer-detail-body">
                    <div class="customer-detail-info">
                        <h3 id="customerDetailName"></h3>
                        <div id="customerDetailContact"></div>
                        <div id="customerDetailLocation"></div>
                    </div>
                    
                    <div class="visit-tracking-section">
                        <div class="visit-status">
                            <div class="visit-stat">
                                <label>Last Visit:</label>
                                <span id="customerLastVisit">Never</span>
                            </div>
                            <button class="btn btn-primary" id="markVisitedBtn">Mark Visited Today</button>
                        </div>
                        
                        <div class="form-group">
                            <label>Visit Notes</label>
                            <textarea id="customerVisitNotes" rows="4" placeholder="Add notes about this customer..."></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelCustomerDetailBtn">Close</button>
                            <button type="button" class="btn btn-primary" id="saveCustomerNotesBtn">Save Notes</button>
                        </div>
                    </div>
                    
                    <div class="visit-history-section">
                        <h3>Visit History</h3>
                        <div id="visitHistoryList"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- New Product Modal -->
        <div class="modal" id="productModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Add New Product</h2>
                    <button class="modal-close" id="closeProductModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="productForm">
                        <div class="form-group">
                            <label>Category / Brand *</label>
                            <select id="productCategory" required>
                                <option value="">Select existing category...</option>
                                <option value="__new__">‚ûï Create New Category</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="newCategoryGroup" style="display: none;">
                            <label>New Category Name *</label>
                            <input type="text" id="newCategoryName" placeholder="e.g., New Line Name">
                        </div>
                        
                        <div class="form-group">
                            <label>Product Name *</label>
                            <input type="text" id="productName" placeholder="e.g., Robusto 5x50 Box 20" required>
                        </div>
                        
                        <div class="form-group">
                            <label>SKU *</label>
                            <input type="text" id="productSku" placeholder="e.g., MFROBU20" required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Price *</label>
                                <input type="number" id="productPrice" step="0.01" min="0" placeholder="0.00" required>
                            </div>
                            <div class="form-group">
                                <label>Box Size *</label>
                                <input type="number" id="productBoxSize" min="1" placeholder="20" required>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelProductBtn">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Product</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="mfc-data.js"></script>
    <script src="app.js"></script>
    <script src="pwa.js"></script>
</body>
</html>
